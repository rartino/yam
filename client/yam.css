:root { --bg:#0b0b0b; --fg:#eaeaea; --muted:#999; --me:#2b6cb0; --other:#2d2d2d; --bubble-me:#1f6feb; --bubble-other:#202124; }
html, body { margin:0; padding:0; width:100%; height:100dvh; overflow:hidden; background:var(--bg); color:var(--fg); }
#app { height:100dvh; display:flex; flex-direction:column; }

header{
  position: sticky; top: 0; z-index: 50;
  background:#111; padding-top: max(12px, env(safe-area-inset-top));
  border-bottom: 1px solid #222; display:flex; align-items:center; justify-content:space-between;
}
.hdr-left{ display:flex; flex-direction:column; }
.icon-btn{ background:transparent; border:0; padding:8px; border-radius:10px; color:#ccc; }
.icon-btn:active{ transform:scale(0.98); }
header h1 { margin:0; font-size:16px; display:flex; align-items:center; gap:8px; }
.app-logo { width:18px; height:18px; display:block; margin-left: 8px; }

#diagnostics { color: var(--muted); margin-left: 6px; font-weight: 400; }

main{
  min-height: 0; overflow: hidden; flex:1;
  display:grid; grid-template-rows: 1fr auto; /* messages grows; composer fixed */
}
.messages{
  min-height:0; -webkit-overflow-scrolling: touch; overflow:auto;
  padding:12px 12px 4px; display:flex; flex-direction:column; gap:8px;
}
.row { display:flex; width:100%; }
.row .wrap{ max-width:75%; display:flex; flex-direction:column; }
.name-label{ font-size:11px; color:#bbb; margin:2px 8px 4px; }
.bubble { max-width:100%; padding:10px 12px; border-radius:16px; line-height:1.25; position:relative; word-wrap:break-word; }
.me   { justify-content:flex-end; }
.me .bubble { background:var(--bubble-me); color:white; border-top-right-radius:6px; }
.other { justify-content:flex-start; }
.other .bubble { background:var(--bubble-other); color:#eaeaea; border-top-left-radius:6px; }
.bubble img { width: 100%; height: auto; display:block; border-radius:12px; }
.file-link { color:#cdd; text-decoration: underline; word-break: break-all; }

.composer{
  display:grid; grid-template-columns: auto 1fr auto; gap:8px;
  background:#0b0b0b; padding:12px 16px; border-top:1px solid #222;
  padding-bottom: max(12px, env(safe-area-inset-bottom));
}
.composer input, .composer button {
  padding:12px; border-radius:12px; border:1px solid #333; background:#151515; color:#eaeaea;
}
.attach-btn { display:flex; align-items:center; justify-content:center; width:44px; }
.attach-btn svg { display:block; }

footer { padding:8px 16px; font-size:12px; color:#999; border-top:1px solid #222; }
.keyhint { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:#a7b; overflow-wrap:anywhere; }

/* Dialog */
dialog{ position:relative; border:1px solid #333; border-radius:14px; padding:16px; background:#121212; color:#eaeaea; width:min(560px,94vw); }
dialog::backdrop{ background:rgba(0,0,0,.6); }
.dialog-close{ position:absolute; top:8px; right:10px; background:transparent; border:0; color:#aaa; font-size:22px; line-height:1; cursor:pointer; }

.settings-stack{ display:flex; flex-direction:column; gap:14px; }
.field label{ display:block; font-size:12px; color:#bbb; margin:0 0 6px; }
.field input{ width:100%; padding:12px; border-radius:12px; border:1px solid #333; background:#151515; color:#eaeaea; }

.row-buttons button,
.settings-actions button,
.avatar-actions button,
.profile-actions button{
  padding:12px; border-radius:12px; border:1px solid #333;
  background:#1a1a1a; color:#eaeaea; cursor:pointer;
}
.row-buttons button:active,
.settings-actions button:active,
.avatar-actions button:active,
.profile-actions button:active{ transform:scale(0.98); }

/* Make button groups responsive: stack on small screens, split on wider */
.avatar-actions,
.row-buttons,
.profile-actions{
  display:grid;
  grid-template-columns: 1fr;
  gap:8px;
}
@media (min-width: 420px){
  .avatar-actions,
  .row-buttons,
  .profile-actions{
    grid-template-columns: 1fr 1fr;
  }
}

/* If a group has only one button (e.g., just "Save"), keep it full width */
.profile-actions:has(> :only-child){ grid-template-columns: 1fr; }

/* Inputs match the rest */
.profile-fields .field input,
.profile-fields .field textarea{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #333;
  background:#151515;
  color:#eaeaea;
}

.help{ margin:6px 0 0; }
.settings-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }

.pending { display:flex; align-items:center; gap:8px; opacity:0.9; }
.retry-btn {
  display:inline-flex; align-items:center; justify-content:center;
  width:28px; height:28px; border-radius:50%;
  border:1px solid #333; background:#1a1a1a; color:#eaeaea; cursor:pointer;
}
.retry-btn:active { transform:scale(0.96); }
.retry-icon { width:16px; height:16px; display:block; }

.hdr-center{ position: absolute; left:50%; transform:translateX(-50%); display:flex; align-items:center; }
.room-button{
  display:flex; align-items:center; gap:6px; background:transparent; border:1px solid #333; color:#eaeaea;
  border-radius:12px; padding:6px 10px; cursor:pointer;
}
.room-button .chev{ opacity:.7; }
.room-menu{
  position:absolute; top:calc(100% + 8px); left:50%; transform:translateX(-50%);
  min-width:220px; background:#121212; border:1px solid #333; border-radius:12px; padding:6px; z-index:60;
  box-shadow: 0 8px 24px rgba(0,0,0,.4);
}
.room-item{ display:flex; justify-content:space-between; gap:8px; padding:8px 10px; border-radius:10px; cursor:pointer; }
.room-item:hover{ background:#1a1a1a; }
.room-item .sub{ font-size:11px; color:#aaa; }
.room-create{ margin-top:6px; padding:8px 10px; border-top:1px solid #222; cursor:pointer; color:#cde; }
.room-create:hover{ background:#161616; }

/* Settings dropdown (right side) */
.hdr-right{ position: relative; }
.settings-menu{
  position:absolute; top:calc(100% + 8px); right:0;
  min-width:220px; background:#121212; border:1px solid #333; border-radius:12px; padding:6px; z-index:60;
  box-shadow: 0 8px 24px rgba(0,0,0,.4);
}
.settings-item{ padding:8px 10px; border-radius:10px; cursor:pointer; display:flex; justify-content:space-between; gap:8px; }
.settings-item:hover{ background:#1a1a1a; }

.menu-head{ display:flex; gap:10px; align-items:center; padding:8px 10px 6px; }
.menu-logo{ width:28px; height:28px; display:block; }
.brand-line{ display:flex; align-items:baseline; gap:6px; }
.brand-name{ font-weight:600; }
.version{ color:#999; font-weight:400; }
.tagline{ font-size:11px; color:#aaa; }
.menu-sep{ border:0; border-top:1px solid #222; margin:6px 0; }

/* Profile dialog: make it single-column, mobile-first */
.profile-grid{
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* Keep avatar centered on top */
.avatar-col{
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
}

/* Avatar preview stays circular and contained */
.avatar-preview{
  width:84px; height:84px;
  border-radius:50%; overflow:hidden;
  background:#222; color:#777; font-size:12px;
  display:flex; align-items:center; justify-content:center;
}
.avatar-preview img{ width:100%; height:100%; object-fit:cover; display:block; }

.avatar-actions{ display:flex; gap:8px; }
.profile-fields{ display:flex; flex-direction:column; gap:14px; }
.profile-fields .field input,
.profile-fields .field textarea{
  width:100%; padding:12px; border-radius:12px; border:1px solid #333; background:#151515; color:#eaeaea;
}
.profile-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }

/* --- utilities --- */
.hidden { display: none !important; }
.no-resize { resize: none; }

/* --- dialog headings --- */
.modal-title { margin: 0 0 10px; }

/* --- action bars --- */
.settings-actions {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}
.settings-actions--split { justify-content: space-between; }
.settings-actions--end   { justify-content: flex-end; }

/* --- row button grids --- */
.row-buttons {
  display: grid;
  gap: 8px;
}
.row-buttons--auto2 { grid-template-columns: auto auto; }
/* If you also use a responsive 1fr/1fr variant elsewhere, keep that as a separate class. */

/* --- textarea used for codes/keys --- */
.codearea {
  width: 100%;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid #333;
  background: #151515;
  color: #eaeaea;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 13px;
  line-height: 1.35;
  box-sizing: border-box;
}
.codearea[readonly] { caret-color: transparent; }

.dangerbutton {
    border-color:#7a1a1a;
    background:#2a0e0e;
    color:#ffb3b3;
}

.errormessage {
    color:#ffb3b3;
}


/* ——— Startup password toggle (collision-proof) ——— */
.field--switch { display:flex; flex-direction:column; gap:8px; }

/* Grid: label left, toggle right */
.ytog {
  display: grid;
  grid-template-columns: 1fr min-content;  /* force the toggle column to be only as wide as needed */
  align-items: center;
  width: 100%;
  column-gap: 12px;
}

/* distance thumb travels when ON */
.ytog--compact .ytog__input:checked + .ytog__track .ytog__thumb {
  transform: translateX(16px);                /* was 18px */
}

/* Hide native checkbox but keep it accessible */
.ytog__input {
  position:absolute;
  width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0;
}

/* Track (visible oval) */
.ytog__track {
  display:inline-block;       /* ensure width/height apply even if grid is reset */
  position:relative;
  width:46px; height:28px;
  border-radius:9999px;
  background: var(--switch-off-bg, #202020);
  border:1px solid var(--switch-off-border, #404040);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.15);
  transition: background .2s ease, border-color .2s ease;
}

/* Thumb (white circle) */
.ytog__thumb {
  position:absolute;
  top:3px; left:3px;
  width:22px; height:22px;
  border-radius:50%;
  background: var(--switch-thumb, #eaeaea);
  transition: transform .2s ease, background-color .2s ease;
}

/* Checked state */
.ytog__input:checked + .ytog__track {
  background: var(--accent, #1f6feb);
  border-color: var(--accent, #1f6feb);
}
.ytog__input:checked + .ytog__track .ytog__thumb {
  transform: translateX(18px);
  background: var(--switch-thumb-on, #fff);
}

/* Keyboard focus ring */
.ytog__input:focus-visible + .ytog__track {
  outline: 2px solid var(--focus, #8ab4f8);
  outline-offset: 2px;
}

/* Label + help */
.ytog__label { color: var(--fg, #eaeaea); font-size:14px; line-height:1.3; }
.ytog__help  { margin:0; font-size:12px; color: var(--muted, #999); line-height:1.35; }


/* ensure the oval sits flush right in its column */
.ytog__track { justify-self: end; }

.ytog--compact { padding: 2px 0; }           /* slight vertical balance */
.ytog--compact .ytog__track {
  width: 38px;                                /* was 46px */
  height: 22px;                               /* was 28px */
  border-radius: 9999px;
}
.ytog--compact .ytog__thumb {
  width: 18px;                                /* was 22px */
  height: 18px;
  top: 2px;                                   /* was 3px */
  left: 2px;
}

.qr-canvas { display:block; margin-top:8px; image-rendering: pixelated; }
.qr-video  { width: 100%; max-height: 40vh; border-radius: 12px; background:#000; }
.bubble:has(+ .meta), .bubble.gap { opacity: .95; }

/* Avatar above the bubble, slightly overlapping */
.msg-avatar {
  width: 28px; height: 28px; border-radius: 50%;
  overflow: hidden; background:#2a2a2a; margin: 0 4px -4px 4px;
  flex: 0 0 auto;
}
.msg-avatar img { width:100%; height:100%; object-fit:cover; display:block; }
.name-label { } 
.bubble { }

.row.other .msg-avatar { float: left; margin-right: .5rem; z-index: 2;position: relative;   }
.row.other .name-label { float: left; margin-right: .5rem; }
.row.other .bubble {  clear: left; z-index: 1;position: relative;   }
.row.me .name-label { float: right; }
.row.me .msg-avatar { float: right; z-index: 2;position: relative;   }
.row.me .bubble { clear: right; z-index: 1; position: relative;   }


.row.other .wrap { display: flow-root; }
.row.me    .wrap { display: flow-root; }

/*
.row.other .msg-avatar { order: 1; }
.row.other .name-label { order: 2; margin-right: auto;}
.row.other .bubble { order: 3; margin-right: auto; flex-basis: 100%;}
.row.me .name-label { order: 1; margin-left: auto;}
.row.me .msg-avatar { order: 2; }
.row.me .bubble { order: 3; margin-left: auto; flex-basis: 100%;}
*/
/* Place the avatar before the bubble and align per side */
/*
.row.other .wrap { align-items: flex-start; flex-direction: row; flex-wrap:wrap;}
.row.me    .wrap { align-items: flex-end; flex-direction: row; flex-wrap:wrap;}
*/

#joinQrCode {
    color: #ffffff;
    background-color: #ffffff;
    padding: 5px;
    margin: 5px;
    display: inline-block;
}

/* ===== BUBBLES + OVERLAYS (minimal, de-duplicated) ===== */

/* Stacking contexts */
.messages { position: relative; isolation: isolate; overflow-x: hidden; }
.row { position: relative; z-index: 0; }
.row.--lift { z-index: 1000; }          /* lift selected row above neighbors */
.msg-avatar { position: relative; z-index: 0; }

/* Bubble base */
.bubble {
  position: relative;
  overflow: visible;                    /* allow bars to hang outside */
  transition: opacity 120ms ease, box-shadow 120ms ease;
}
.bubble._pre { opacity: 0; }
.bubble.--selected { box-shadow: 0 0 0 2px #fff; }

/* Timestamp inside bubble */
.bubble .time-label {
  display: block;
  margin-top: 6px;
  font-size: 11px;
  color: #c9c9c9;
  opacity: 0;
  transition: opacity 120ms ease;
  pointer-events: none;
}
.bubble.--selected .time-label { opacity: 1; }

/* Shared overlay bars */
.bubble .bubble-actions,
.bubble .reactions-bar {
  position: absolute;
  display: flex;
  flex-wrap: nowrap;                    /* single row if it fits */
  white-space: nowrap;
  gap: 8px;
  opacity: 0;
  pointer-events: none;                 /* off until selected */
  transition: opacity 120ms ease, transform 120ms ease;
}
.bubble.--selected .bubble-actions,
.bubble.--selected .reactions-bar {
  opacity: 1;
  pointer-events: auto;
}

/* Z-order: actions above reactions */
.bubble .bubble-actions { z-index: 20; }
.bubble .reactions-bar { z-index: 20; }

/* --- Placement: ACTIONS ABOVE (anchored to inside edge) --- */
.row.other .bubble .bubble-actions {
  top: -28px; left: 12px;
  transform: translateY(-6px);
  justify-content: flex-start;          /* grow rightward */
}
.row.me .bubble .bubble-actions {
  top: -28px; right: 12px;
  transform: translateY(-6px);
  justify-content: flex-end;            /* grow leftward */
}
.row.other .bubble.--selected .bubble-actions,
.row.me .bubble.--selected .bubble-actions {
  transform: translateY(0);
}

/* --- Placement: REACTIONS BELOW (anchored to inside edge) --- */
.row.other .bubble .reactions-bar {
  bottom: -28px; left: 12px;
  transform: translateY(6px);
  justify-content: flex-start;          /* grow rightward */
}
.row.me .bubble .reactions-bar {
  bottom: -28px; right: 12px;
  transform: translateY(6px);
  justify-content: flex-end;            /* grow leftward */
}
.row.other .bubble.--selected .reactions-bar,
.row.me .bubble.--selected .reactions-bar {
  transform: translateY(0);
}

/* Circular buttons (actions + reactions) */
.bubble .action-btn,
.bubble .reaction-btn {
  flex: 0 0 var(--btn-size, 36px);
  inline-size: var(--btn-size, 36px);
  block-size: var(--btn-size, 36px);
  border-radius: 9999px;
  border: none; padding: 0;
  display: inline-flex; align-items: center; justify-content: center;
  background: #fff; color: #111;
  box-shadow: 0 4px 12px rgba(0,0,0,.35);
  cursor: pointer; line-height: 1; font-size: 18px;
  -webkit-appearance: none; appearance: none;
}
.bubble .action-btn:active,
.bubble .reaction-btn:active { transform: scale(0.96); }

#btnNotify {
    grid-column: 1 / span 2;
}

