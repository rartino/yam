<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Yam</title>
  <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
	script-src 'self' 'wasm-unsafe-eval';
        connect-src 'self' https: wss:;
        img-src 'self' blob: data:;
        style-src 'self';
        font-src 'self';
        media-src 'self' blob:;
        worker-src 'self';
        object-src 'none';
        base-uri 'none';
        frame-ancestors 'none'
      ">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="yam.css" /> 
</head>
<body>
  
  <!-- Settings dialog -->
  <dialog id="settingsModal">
    <button id="btnCloseSettings" class="dialog-close" aria-label="Close">×</button>
    <form method="dialog">
      <h3 class="modal-title">Configure room</h3>
      <div class="settings-stack">
	<div class="field">
	  <label for="cfgRoomName">Room name</label>
	  <input id="cfgRoomName" placeholder="Room name" />
	</div>
      </div>
      <div class="settings-actions settings-actions--split">
	<button type="button" id="btnRemoveRoom" class="dangerbutton">Remove room</button>
	<div>
	  <button type="button" id="btnSaveRoomCfg">Save</button>
	</div>
      </div>
    </form>
  </dialog>

  <!-- Profile dialog -->
  <dialog id="profileModal">
    <button id="btnCloseProfile" class="dialog-close" aria-label="Close">×</button>
    <form method="dialog">
      <h3 class="modal-title">Profile</h3>

      <div class="profile-grid">
	<div class="avatar-col">
	  <div id="avatarPreview" class="avatar-preview">No avatar</div>
	  <div class="avatar-actions">
	    <button type="button" id="btnAvatarUpload">Upload</button>
	    <button type="button" id="btnAvatarClear">Clear</button>
	  </div>
	  <input id="avatarInput" type="file" accept="image/*" class="hidden" />
	</div>

	<div class="profile-fields">
	  <div class="field">
	    <label for="profName" class="muted">Display name</label>
	    <input id="profName" placeholder="Your name" autocomplete="off" autocapitalize="words" />
	  </div>

	  <div class="field">
	    <label class="muted">Public device key</label>
	    <textarea id="profPubKey" class="codearea no-resize" rows="3" readonly spellcheck="false"></textarea>
	    <div class="row-buttons row-buttons--auto2">
	      <button type="button" id="btnCopyPubKey">Copy</button>
	      <button type="button" id="btnRegenIdentity">Regenerate identity</button>
	    </div>
	  </div>
	</div>
      </div>

      <div class="profile-actions">
	<button type="button" id="btnSaveProfile">Save</button>
      </div>
    </form>
  </dialog>
  
  <!-- Create room dialog -->  
  <dialog id="createRoomModal">
    <button id="btnCloseCreateRoom" class="dialog-close" aria-label="Close">×</button>
    <form method="dialog">
      <h3 class="modal-title">Create new room</h3>
      <div class="settings-stack">
	<div class="field">
	  <label for="newRoomName">Room name</label>
	  <input id="newRoomName" placeholder="e.g., Family chat" />
	</div>
	<div class="field">
	  <label for="newServerUrl">Server URL</label>
	  <input id="newServerUrl" placeholder="https://rartino.pythonanywhere.com" />
	  <p class="muted help">Use the base URL of your relay server (no trailing slash).</p>
	</div>
      </div>
      <div class="settings-actions">
	<button type="button" id="btnCreateRoom">Create room</button>
      </div>
    </form>
  </dialog>
  
  <!-- Invite (sender) -->
  <dialog id="inviteModal">
    <button id="btnCloseInvite" class="dialog-close" aria-label="Close">×</button>
    <form method="dialog">
      <h3 class="modal-title">Invite to this room</h3>
      <div class="settings-stack">
	<p class="muted help">Step 1: Copy this invitation code and send it to your friend.</p>
	<div class="field">
	  <label>Invitation code</label>
	  <textarea id="inviteOffer" class="codearea" readonly rows="5"></textarea>
	  <div class="row-buttons row-buttons--auto2">
	    <button type="button" id="btnCopyInviteOffer">Copy</button>
	    <button type="button" id="btnRefreshInviteOffer">Regenerate</button>
	  </div>
	</div>

	<p class="muted help">Step 2: Paste the response code you get back and finish.</p>
	<div class="field">
	  <label>Response code</label>
	  <textarea id="inviteAnswer" class="codearea" rows="5" placeholder="Paste response code here"></textarea>
	</div>
      </div>
      <div class="settings-actions settings-actions--end">
	<button type="button" id="btnFinishInvite">Finish</button>
      </div>
    </form>
  </dialog>

  <!-- Join (receiver) -->
  <dialog id="joinModal">
    <button id="btnCloseJoin" class="dialog-close" aria-label="Close">×</button>
    <form method="dialog">
      <h3 class="modal-title">Join a room</h3>
      <div class="settings-stack">
	<p class="muted help">Step 1: Paste the invitation code you received.</p>
	<div class="field">
	  <label>Invitation code</label>
	  <textarea id="joinOffer" class="codearea" spellcheck="false" rows="5" placeholder="Paste invitation code here"></textarea>
	</div>

	<p class="muted help">Step 2: Copy the response code below and send it back.</p>
	<div class="field">
	  <label>Response code</label>
	  <textarea id="joinAnswer" class="codearea" spellcheck="false" readonly rows="5"></textarea>
	  <div class="row-buttons row-buttons--auto2">
	    <button type="button" id="btnMakeJoinAnswer">Generate response</button>
	    <button type="button" id="btnCopyJoinAnswer">Copy</button>
	  </div>
	</div>
      </div>
    </form>
  </dialog>
  
  <div id="app">
    <header>
      <div class="hdr-left">
        <h1><img src="logo.svg" alt="" class="app-logo">Yam<span id="status">↮</span></h1>
      </div>
      <div class="hdr-center">
	<button id="btnRoomMenu" class="room-button" aria-haspopup="true" aria-expanded="false">
	  <span id="currentRoomName">No room</span>
	  <svg class="chev" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" aria-hidden="true">
	    <path d="M7 10l5 5 5-5z"/>
	  </svg>
	</button>
	<div id="roomMenu" class="room-menu" hidden></div>
      </div>
      <div class="hdr-right">
	<button id="btnSettings" class="icon-btn" aria-label="Settings" title="Settings">
	  <!-- gear icon -->
	  <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
	    <path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm8.94 3.24-.97-.56a7.96 7.96 0 0 0-.26-1l.73-.89a.7.7 0 0 0-.08-.98l-1.1-1.1a.7.7 0 0 0-.98-.08l-.89.73c-.32-.12-.66-.21-1-.26l-.56-.97a.7.7 0 0 0-.62-.36h-1.56a.7.7 0 0 0-.62.36l-.56.97c-.34.05-.68.14-1 .26l-.89-.73a.7.7 0 0 0-.98.08l-1.1 1.1a.7.7 0 0 0-.08.98l.73.89c-.12.32-.21.66-.26 1l-.97.56a.7.7 0 0 0-.36.62v1.56c0 .26.14.5.36.62l.97.56c.05.34.14.68.26 1l-.73.89a.7.7 0 0 0 .08.98l1.1 1.1c.25.25.64.27.92.08l.89-.73c.32.12.66.21 1 .26l.56.97c.12.22.36.36.62.36h1.56c.26 0 .5-.14.62-.36l.56-.97c.34-.05.68-.14 1-.26l.89.73c.28.2.67.17.92-.08l1.1-1.1c.25-.25.27-.64.08-.92l-.73-.89c.12-.32.21-.66.26-1l.97-.56c.22-.12.36-.36.36-.62v-1.56a.7.7 0 0 0-.36-.62Z"/>
	  </svg>
	</button>
	<div id="settingsMenu" class="settings-menu" hidden>
	  <div class="menu-head">
	    <img src="logo.svg" alt="Yam" class="menu-logo" />
	    <div class="brand">
	      <div class="brand-line">
		<span class="brand-name">Yam</span>
		<span id="menuVersion" class="version"></span>
	      </div>
	      <div class="tagline">Yet Another Messenger</div>
	    </div>
	  </div>
	  <hr class="menu-sep" />
	  <div id="menuProfile"  class="settings-item">Profile</div>
	  <div id="menuRoomOpts" class="settings-item">Room options</div>
	  <div id="menuInvite"   class="settings-item">Invite to room</div>
	</div>
      </div>
    </header>

    <main>
      <div id="messages" class="messages"></div>

      <div class="composer">
        <button id="btnAttach" class="attach-btn" title="Attach">
          <!-- paperclip -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M16.5,6.5 L8.5,14.5 C7.1,15.9 7.1,18.1 8.5,19.5 C9.9,20.9 12.1,20.9 13.5,19.5 L19,14 C21,12 21,8.9 19,6.9 C17,4.9 13.9,4.9 11.9,6.9 L6,12.8"/>
          </svg>
        </button>
        <input id="messageInput" placeholder="Type a message…" />
        <button id="btnSend">Send</button>
        <input id="fileInput" type="file" class="hidden" />
      </div>
    </main>
  </div>

  <script src="vendor/sodium/sodium.js"></script>
  <script type="module" src="boot.js"></script>

</body>
</html>
